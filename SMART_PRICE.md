**SMART‑провайдер лимита цены (опционально)**

- Назначение: получать лимит цены по артикулу из БД вместо Excel.
- Реализация: `ebay_my_news/price_provider_smart.py` (asyncpg, KISS).

**Включение**
- Флаг в `.env` (используется общий `validation_redis_service/.env`):
  - `USE_SMART_PRICE=1` — включить, `0` — выключить (по умолчанию).

**Подключения к БД**
- parts_admin (таблица `public.smart`):
  - `PARTS_ADMIN_HOST`, `PARTS_ADMIN_PORT`, `PARTS_ADMIN_DB`, `PARTS_ADMIN_USER`, `PARTS_ADMIN_PASSWORD`.
- ebay_admin (view `public.parts_prices`):
  - `EBAY_ADMIN_HOST`, `EBAY_ADMIN_PORT`, `EBAY_ADMIN_DB`, `EBAY_ADMIN_USER`, `EBAY_ADMIN_PASSWORD`.

**Как работает**
- На вход берём артикул из Excel (им же идём в eBay‑каталог — без изменений).
- Для сопоставления с БД выполняем нормализацию (только на время поиска):
  - верхний регистр + удаление всех символов, кроме `[A‑Z0‑9]`.
- Ищем `smart` в `parts_admin.public.smart` по вхождению нормализованного артикула
  в массиве столбца `"артикул"`.
- По найденному `smart` читаем из вьюхи `ebay_admin.public.parts_prices`
  поля `min_price_by_market`, `min_price_by_user`.
- Выбор цены: минимальная из всех доступных (min(market, user)). Если обе `NULL` — цены нет.
- Fallback: если цены по SMART нет — используем колонку B из Excel. Если и её нет — лимит не задаётся.

**Интеграция**
- Задействовано в `ebay_my_news/main_excel.py`: при включённом флаге
  лимит подставляется перед постановкой задач в очередь.
- Режим `main.py` (DB‑loop) не менялся.

**Зависимости**
- `asyncpg` (используем только его; SQLAlchemy не требуется).

**Производительность и кэш**
- Маппинг `артикул → smart` загружается один раз при первом обращении,
  кэшируется в памяти процесса (быстрый повторный поиск).

**Проверка (ручная)**
1) В `.env` включить `USE_SMART_PRICE=1` и задать параметры подключения.
2) Запустить `app-main` (Excel‑режим). В логах `QUERY SEND (excel)`
   будет отображаться подставленный `max_price`.

**Ограничения**
- Ожидается единственная строка на `smart` в `parts_prices` (как в вьюхе).
- Нормализация применяется только для поиска в БД; исходный артикул в eBay‑поиске не меняется.
